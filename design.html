<!DOCTYPE html>
<html>

<head>
  <title>HTML Layout Example</title>
  <link rel="stylesheet" type="text/css" href="layout.css">
  <script src="fonts.js"></script>
  <script src="script.js""></script>
</head>

<body>
  <div class=" main-section">
    <div class="main-top">
        <div class="main-left">
            <div id="grid">
                <!-- Dots will be generated here -->
            </div>
        </div>
        <div class="main-right">
            <div>
                <div class="containerPanel">
                    <div label="Cursor">
                            <button onclick="markCursor()">Mark</button>
                            <button onclick="moveCursor(1,0)">Right</button>
                            <button onclick="moveCursor(-1,0)">Left</button>
                            <button onclick="moveCursor(0,-1)">Up</button>
                            <button onclick="moveCursor(0,1)">Down</button>
                    </div>
                </div>
                <div class="containerPanel">
                    <div label="Pixel">
                        <input type="color" id="colorWheel" onchange="selectColor(this.value)">
                    </div>
                    <div label="Content">
                        <button onclick="showDots()">Display</button>
                        <button onclick="clearDots()">Erase</button>
                        <button onclick="saveContents()">Save</button>
                        <button onclick="loadContents()">Load</button>
                    </div>
                </div>
            </div>
            <div id="pixel-grid"></div>
            <div class="containerPanel">
                <div label="Fonts">
                    <button onclick="copyFont()">Copy</button>
                    <button onclick="addFont()">Add</button>
                    <button onclick="clearGridEditor()" Font()">Clear</button>
                    <button onclick="updateFont()">Update</button>
                </div>
                <div label="Keys">
                    <button onclick="loadFontsArray()">Load</button>
                    <button onclick="exportFonts()">Export</button>
                </div>
                <div label="Server IP">
                    <input type="text" id="apiServer" onchange="updateServer(this)"></input>
                    <button onclick="setDefaultServer(this)">Default</button>
                </div>
            </div>
        </div>
    </div>
    <div class="fixed-bottom">
        <div class="keyboard"></div>
    </div>
  </div>
    <div id="spinner"></div> <!-- Spinner element - hidden until needed to show long running operations -->
    <input type="file" id="fileInput" style="display: none;" multiple />
    <script>
        const pixels = {};
        document.addEventListener("DOMContentLoaded", function () {
            const apiServer = document.getElementById('apiServer');
            apiServer.value = API_SERVER;

            const colorWheel = document.getElementById('colorWheel');
            colorWheel.value = selectedColor;

            const grid = document.getElementById('pixel-grid');

            // Create 16x16 grid of pixels
            for (let row = 0; row < 16; row++) {
                pixels[row] = {};
                for (let col = 0; col < 128; col++) {
                    const pixel = document.createElement('div');
                    pixel.row = row; pixel.col = col;
                    pixels[row][col] = pixel;
                    pixel.classList.add('pixel');
                    pixel.selected = false;
                    pixel.addEventListener('click', function () {
                        if (grid.selectingPixel) {
                            grid.selectingPixel = false;
                            grid.classList.remove('selecting');
                            grid.classList.add('lighting');
                            grid.selectedPixel.classList.toggle('selected');
                            (grid.selectedPixel = pixel).classList.toggle('selected');
                            grid.charPosX = pixel.col;
                            grid.charPosY = pixel.row;
                        }
                        else {
                            pixel.selected = !pixel.selected;
                            if (pixel.selected) {
                                pixel.classList.add('on');
                                pixel.style.backgroundColor = selectedColor;
                                panelDots.push({ row, col, color: selectedColor })
                            }
                            else {
                                const index = panelDots.findIndex(d => d.row === row && d.col === col);
                                panelDots.splice(index, 1);
                                pixel.style.backgroundColor = 'white';
                                pixel.classList.remove('on');
                            }
                        }
                    });
                    grid.appendChild(pixel);
                }
            }

            // init cursor position to top left
            grid.charPosX = 0;
            grid.charPosY = 3;
            (grid.selectedPixel = pixels[grid.charPosY][grid.charPosX]).classList.toggle('selected');

            // init with lighting up mode
            grid.selectingPixel = false;
            grid.classList.add('lighting');

            // Example usage: light up a diagonal line
            const pixelsToLightUp = [
                [0, 0], [1, 1], [2, 2], [3, 3], [4, 4], [5, 5], [6, 6], [7, 7], [8, 8], [9, 9],
                [10, 10], [11, 11], [12, 12], [13, 13], [14, 14], [15, 15]
            ];
            //  lightUpPixels(pixelsToLightUp);

            var spinner = document.getElementById('spinner');

        });

    </script>

    <script>
        const rows = 16, cols = 1 * 16;
        const linePos = [0, 2, 9, 12, 15];
        const colPos = [0, 15];  //0, 15, 31, 47, 63, 79, 95];

        function drawLine(startPt, cls, posDot, topSide) {
            const divider = document.createElement('div');
            divider.classList.add(cls);
            const pos = posDot.getBoundingClientRect();
            divider.style.top = (topSide ? pos.top : pos.bottom) + 'px';
            divider.style.width = (pos.right - startPt) + 'px';
            grid.appendChild(divider);
        }

        function drawVLine(startPt, cls, posDot, topSide) {
            const divider = document.createElement('div');
            divider.classList.add(cls);
            const pos = posDot.getBoundingClientRect();
            divider.style.left = (topSide ? pos.left : pos.right) + 'px';
            divider.style.height = (pos.bottom - startPt) + 'px';
            grid.appendChild(divider);
        }

        function createGrid() {
            const grid = document.getElementById('grid');
            grid.style.gridTemplateColumns = `repeat(${cols}, 8px)`;
            const hLineDots = {};
            const vLineDots = {};
            var dotRect, topPos, leftPos;
            for (let row = 0; row < rows; row++) {
                for (let col = 0; col < cols; col++) {
                    const dot = document.createElement('div');
                    dot.classList.add('dot');
                    dot.dataset.row = row;
                    dot.dataset.col = col;
                    dot.addEventListener('click',
                        () => toggleDot(dot, row, col));

                    grid.appendChild(dot);

                    // capture horizontal line positions
                    if (col == (cols - 1) && linePos.includes(row)) {
                        hLineDots[row] = dot;
                    }

                    if (row == 0 && !topPos) {
                        topPos = dot.getBoundingClientRect().top;
                    }

                    if (col == 0 && !leftPos) {
                        leftPos = dot.getBoundingClientRect().left;
                    }

                    // capture vertical line positions
                    if (row == (rows - 1) && colPos.includes(col)) {
                        vLineDots[col] = dot;
                    }
                }
            }

            // draw horizontal lines
            for (pos of linePos) {
                drawLine(leftPos, 'divider', hLineDots[pos], pos == 0)
            }

            // draw vertical lines
            for (pos of colPos) {
                // drawVLine(topPos, 'divider-v', vLineDots[pos], pos==0)
            }
        }
        window.onload = createGrid;
    </script>
</body>

</html>